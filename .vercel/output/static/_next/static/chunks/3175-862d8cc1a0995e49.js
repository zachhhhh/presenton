"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3175],{88509:function(e,t,a){a.d(t,{_:function(){return V}});var r=a(57437),s=a(2265),n=a(68575),l=a(87462),i=a(91626),o=a(69304),c=a(12339),d=a(62869),u=a(76818),m=a(62883),p=a(17689),h=a(51817),g=a(27413),f=a(94508),x=a(61482),v=a(93022),b=a(14438),y=a(56295),j=a(84025),N=a(79875);class w{static async uploadImage(e){try{let t=new FormData;t.append("file",e);let a=await fetch("/api/v1/ppt/images/upload",{method:"POST",headers:(0,j.V)(),body:t});return await N.z.handleResponse(a,"Failed to upload image")}catch(e){throw console.log("Upload error:",e.message),e}}static async getUploadedImages(){try{let e=await fetch("/api/v1/ppt/images/uploaded");return await N.z.handleResponse(e,"Failed to get uploaded images")}catch(e){throw console.log("Get uploaded images error:",e),e}}static async deleteImage(e){try{let t=await fetch("/api/v1/ppt/images/".concat(e),{method:"DELETE"});return await N.z.handleResponse(t,"Failed to delete image")}catch(e){throw console.log("Delete image error:",e),e}}}var _=a(46281),E=s.memo(e=>{let{initialImage:t,imageIdx:a=0,promptContent:n,properties:l,onClose:i,onFocusPointClick:j,onImageChange:N}=e,[E,C]=(0,s.useState)(t),[P,k]=(0,s.useState)([]),[S,A]=(0,s.useState)(""),[I,T]=(0,s.useState)(!1),[F,O]=(0,s.useState)(null),[L,U]=(0,s.useState)(!1),[R,z]=(0,s.useState)(null),[D,M]=(0,s.useState)(null),[G,B]=(0,s.useState)(!0),[V,Z]=(0,s.useState)([]),[q,Y]=(0,s.useState)(!1),[H,X]=(0,s.useState)(!1),[W,Q]=(0,s.useState)(l&&l[a]&&l[a].initialFocusPoint||{x:50,y:50}),[$,J]=(0,s.useState)(l&&l[a]&&l[a].initialObjectFit||"cover"),K=(0,s.useRef)(null),{user:ee,checkUsageLimit:et}=(0,_.a)();(0,s.useEffect)(()=>{C(t)},[t]),(0,s.useEffect)(()=>{G&&!P.length&&er()},[G]);let ea=()=>{B(!1),setTimeout(()=>{null==i||i()},300)},er=async()=>{try{(0,y.L9)(y.j7.ImageEditor_GetPreviousGeneratedImages_API_Call);let e=await x.f.getPreviousGeneratedImages();k(e)}catch(e){b.Am.error("Failed to get previous generated images. Please try again."),console.error("error in getting previous generated images",e),O(e.message||"Failed to get previous generated images. Please try again.")}},es=e=>{N&&(N(e,n),C(e))},en=e=>{if(!H||!K.current)return;let t=K.current.getBoundingClientRect(),a=Math.max(0,Math.min(100,(e.clientX-t.left)/t.width*100)),r=Math.max(0,Math.min(100,(e.clientY-t.top)/t.height*100));Q({x:a,y:r}),eo($,{x:a,y:r}),K.current&&(K.current.style.objectPosition="".concat(a,"% ").concat(r,"%"))},el=()=>{H&&eo($,W),X(!H)},ei=e=>{J(e),K.current&&(K.current.style.objectFit=e),eo(e,W)},eo=(e,t)=>{null==j||j({initialObjectFit:e,initialFocusPoint:t})},ec=async()=>{if(!S){O("Please enter a prompt");return}if(ee&&!await et("images",1)){b.Am.error("Image generation limit exceeded",{description:"You have reached your monthly image generation limit. Please upgrade your subscription to continue."});return}try{T(!0),O(null),(0,y.L9)(y.j7.ImageEditor_GenerateImage_API_Call);let e=await x.f.generateImage({prompt:S});C(e)}catch(e){console.error("Error in image generation",e),O(e.message||"Failed to generate image. Please try again.")}finally{T(!1)}},ed=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){if(a.size>5242880){z("File size should be less than 5MB");return}if(!a.type.startsWith("image/")){z("Please upload an image file");return}try{U(!0),z(null),(0,y.L9)(y.j7.ImageEditor_UploadImage_API_Call);let e=await w.uploadImage(a);M(e.path)}catch(e){z("Failed to upload image. Please try again."),b.Am.error(e.message||"Failed to upload image. Please try again."),console.log("Upload error:",e.message)}finally{U(!1)}}},eu=async()=>{try{Y(!0);let e=await w.getUploadedImages();Z(e)}catch(e){b.Am.error(e.message||"Failed to get uploaded images. Please try again."),console.log("Get uploaded images error:",e.message)}finally{Y(!1)}},em=async e=>{try{let t=await w.deleteImage(e);Z(V.filter(t=>t.id!==e)),b.Am.success(t.message||"Image deleted successfully")}catch(e){b.Am.error(e.message||"Failed to delete image. Please try again.")}};return(0,r.jsx)("div",{className:"image-editor-container",children:(0,r.jsx)(o.yo,{open:G,onOpenChange:()=>ea(),children:(0,r.jsxs)(o.ue,{side:"right",className:"w-[600px]",onOpenAutoFocus:e=>e.preventDefault(),onClick:e=>e.stopPropagation(),children:[(0,r.jsx)(o.Tu,{children:(0,r.jsx)(o.bC,{children:"Update Image"})}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsxs)(c.mQ,{defaultValue:"generate",className:"w-full",onValueChange:e=>{"upload"===e&&eu()},children:[(0,r.jsxs)(c.dr,{className:"grid bg-blue-100 border border-blue-300 w-full grid-cols-3 mx-auto",children:[(0,r.jsx)(c.SP,{className:"font-medium",value:"generate",children:"AI Generate"}),(0,r.jsx)(c.SP,{className:"font-medium",value:"upload",children:"Upload"}),(0,r.jsx)(c.SP,{className:"font-medium",value:"edit",children:"Edit"})]}),(0,r.jsx)(c.nU,{value:"generate",className:"mt-4 space-y-4 overflow-y-auto hide-scrollbar h-[85vh]",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium mb-1",children:"Current Prompt"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:n})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-base font-medium mb-2",children:"Image Description"}),(0,r.jsx)(u.g,{placeholder:"Describe the image you want to generate...",value:S,onChange:e=>A(e.target.value),className:"min-h-[100px]"})]}),(0,r.jsxs)(d.z,{onClick:ec,className:"w-full",disabled:!S||I,children:[(0,r.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),I?"Generating...":"Generate Image"]}),F&&(0,r.jsx)("p",{className:"text-red-500 text-sm",children:F}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-4",children:I||!E?Array.from({length:4}).map((e,t)=>(0,r.jsx)(v.O,{className:"aspect-[4/3] w-full rounded-lg"},t)):(0,r.jsx)("div",{onClick:()=>es(E),className:"aspect-[4/3] w-full overflow-hidden rounded-lg border cursor-pointer hover:border-blue-500 transition-colors",children:E&&(0,r.jsx)("img",{src:E,alt:"Preview",className:"w-full h-full object-cover"})})}),P.length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Previous Generated Images"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-4  ",children:P.map(e=>(0,r.jsx)("div",{onClick:()=>es(e.path),className:"aspect-[4/3] w-full overflow-hidden rounded-lg border cursor-pointer hover:border-blue-500 transition-colors",children:(0,r.jsx)("img",{src:e.path,alt:e.extras.prompt,className:"w-full h-full object-cover"})},e.id))})]})]})}),(0,r.jsx)(c.nU,{value:"upload",className:"mt-4 space-y-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:(0,f.cn)("border-2 border-dashed rounded-lg p-8 text-center transition-colors",L?"border-gray-400 bg-gray-50":"border-gray-300 hover:border-blue-400"),children:[(0,r.jsx)("input",{type:"file",id:"file-upload",className:"hidden",accept:"image/*",onChange:ed,disabled:L}),(0,r.jsxs)("label",{htmlFor:"file-upload",className:(0,f.cn)("flex flex-col items-center",L?"cursor-wait":"cursor-pointer"),children:[L?(0,r.jsx)("div",{className:"w-8 h-8 border-2 border-gray-400 border-t-transparent rounded-full animate-spin mb-2"}):(0,r.jsx)(p.Z,{className:"w-8 h-8 text-gray-500 mb-2"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:L?"Uploading your image...":"Click to upload an image"}),(0,r.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:"Maximum file size: 5MB"})]})]}),R&&(0,r.jsx)("p",{className:"text-red-500 text-sm text-center",children:R}),(D||L)&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Uploaded Image Preview"}),(0,r.jsx)("div",{className:"aspect-[4/3] relative rounded-lg overflow-hidden border border-gray-200",children:L?(0,r.jsx)("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-2 border-gray-400 border-t-transparent rounded-full animate-spin mb-2"}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Processing..."})]})}):D&&(0,r.jsxs)("div",{onClick:()=>es(D),className:"cursor-pointer group w-full h-full",children:[(0,r.jsx)("img",{src:D,alt:"Uploaded preview",className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-200"}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,r.jsx)("span",{className:"bg-white/90 px-3 py-1 rounded-full text-sm font-medium",children:"Click to use this image"})})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Uploaded Images:"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-4",children:q?(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)(h.Z,{className:"w-4 h-4 animate-spin"})}):V.map(e=>(0,r.jsx)("div",{children:(0,r.jsxs)("div",{onClick:()=>es(e.path),className:"cursor-pointer group aspect-[4/3] rounded-lg overflow-hidden relative border border-gray-200",children:[(0,r.jsx)(g.Z,{className:"absolute group-hover:opacity-100 opacity-0 transition-opacity z-10 w-4 h-4 top-2 right-2 text-red-500",onClick:t=>{t.stopPropagation(),em(e.id)}}),(0,r.jsx)("img",{src:e.path,alt:"Uploaded preview",className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-200"}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,r.jsx)("span",{className:"bg-white/90 px-3 py-1 rounded-full text-xs font-medium",children:"Use"})})]})},e.id))})]})]})}),(0,r.jsx)(c.nU,{value:"edit",className:"mt-4 space-y-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Current Image"}),(0,r.jsxs)("div",{onClick:e=>{H&&en(e)},className:"aspect-[4/3] group  rounded-lg overflow-hidden relative border border-gray-200",children:[(0,r.jsx)("p",{className:"group-hover:opacity-100 opacity-0 transition-opacity absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-sm text-center font-medium bg-black/50 text-white px-2 py-1 rounded",children:"Click to Change Focus Point"}),E&&(0,r.jsx)("img",{ref:K,onClick:()=>{X(!0)},src:E,style:{objectFit:$,objectPosition:"".concat(W.x,"% ").concat(W.y,"%")},alt:"Preview",className:"w-full h-full "}),H&&(0,r.jsxs)("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center",children:[(0,r.jsxs)("div",{className:"text-white text-center p-2 bg-black/50 rounded",children:[(0,r.jsx)("p",{className:"text-sm font-medium pointer-events-none",children:"Click anywhere to set focus point"}),(0,r.jsx)("button",{className:"mt-2 px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600",onClick:e=>{e.stopPropagation(),el()},children:"Done"})]}),(0,r.jsxs)("div",{className:"absolute w-8 h-8 border-2 border-white rounded-full transform -translate-x-1/2 -translate-y-1/2 pointer-events-none",style:{left:"".concat(W.x,"%"),top:"".concat(W.y,"%"),boxShadow:"0 0 0 2px rgba(0,0,0,0.5)"},children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})}),(0,r.jsx)("div",{className:"absolute w-16 h-0.5 bg-white/70 left-1/2 -translate-x-1/2"}),(0,r.jsx)("div",{className:"absolute w-0.5 h-16 bg-white/70 top-1/2 -translate-y-1/2"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Object Fit"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)(d.z,{variant:"outline",className:(0,f.cn)("cover"===$&&"bg-blue-50 border-blue-500"),onClick:()=>ei("cover"),children:"Cover"}),(0,r.jsx)(d.z,{variant:"outline",className:(0,f.cn)("contain"===$&&"bg-blue-50 border-blue-500"),onClick:()=>ei("contain"),children:"Contain"}),(0,r.jsx)(d.z,{variant:"outline",className:(0,f.cn)("fill"===$&&"bg-blue-50 border-blue-500"),onClick:()=>ei("fill"),children:"Fill"})]})]})]})})]})})]})})})}),C=a(95186),P=a(73247),k=e=>{let{icon_prompt:t,onClose:a,onIconChange:n}=e,[l,i]=(0,s.useState)([]),[c,u]=(0,s.useState)((null==t?void 0:t[0])||""),[m,p]=(0,s.useState)(!0),[h,g]=(0,s.useState)(!0);(0,s.useEffect)(()=>{t&&t.length>0&&0===l.length&&f()},[]);let f=async()=>{p(!0);let e=c.length>0?c:(null==t?void 0:t[0])||"";try{let t=await x.f.searchIcons({query:e,limit:40});i(t)}catch(e){console.error("Error fetching icons:",e),b.Am.error(e.message||"Failed to fetch icons. Please try again."),i([])}finally{p(!1)}},y=e=>{n&&n(e,c||(null==t?void 0:t[0])||""),j()},j=()=>{g(!1),setTimeout(()=>{null==a||a()},300)};return(0,r.jsx)("div",{className:"icons-editor-container",children:(0,r.jsx)(o.yo,{open:h,onOpenChange:()=>j(),children:(0,r.jsxs)(o.ue,{side:"right",className:"w-[400px]",onOpenAutoFocus:e=>e.preventDefault(),onClick:e=>e.stopPropagation(),children:[(0,r.jsx)(o.Tu,{children:(0,r.jsx)(o.bC,{children:"Choose Icon"})}),(0,r.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),f()},children:[(0,r.jsxs)("div",{className:"relative mb-3",children:[(0,r.jsx)(P.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-4 h-4"}),(0,r.jsx)(C.I,{placeholder:"Search icons...",value:c,onChange:e=>u(e.target.value),onClick:e=>e.stopPropagation(),className:"pl-10"})]}),(0,r.jsx)(d.z,{type:"submit",variant:"outline",className:"w-full text-semibold text-[#51459e]",onClick:e=>e.stopPropagation(),children:"Search"})]}),(0,r.jsx)("div",{className:"max-h-[80vh] hide-scrollbar overflow-y-auto p-1",children:m?(0,r.jsx)("div",{className:"grid grid-cols-4 gap-4",children:Array.from({length:40}).map((e,t)=>(0,r.jsx)(v.O,{className:"w-16 h-16 rounded-lg"},t))}):l&&l.length>0?(0,r.jsx)("div",{className:"grid grid-cols-4 gap-4",children:l.map((e,t)=>(0,r.jsx)("div",{onClick:t=>{t.stopPropagation(),y(e)},className:"w-12 h-12 cursor-pointer group relative rounded-lg overflow-hidden hover:bg-gray-100 p-2 transition-colors",children:(0,r.jsx)("img",{src:e,alt:"Icon ".concat(t+1),className:"w-full h-full object-contain"})},t))}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-[60vh] text-center text-gray-500 space-y-4",children:[(0,r.jsx)(P.Z,{className:"w-12 h-12 text-gray-400"}),(0,r.jsx)("p",{className:"text-sm",children:"No icons found for your search."}),(0,r.jsx)("p",{className:"text-xs",children:"Try refining your search query."})]})})]})]})})})},S=e=>{var t,a;let{children:l,slideIndex:o,slideData:c,properties:d}=e,u=(0,n.I0)(),m=(0,s.useRef)(null),[p,h]=(0,s.useState)([]),[g,f]=(0,s.useState)(null),x=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!t||"object"!=typeof t)return[];let r=[];for(let[s,n]of(t.__image_url__&&e.includes(t.__image_url__)&&r.push({path:a,type:"image",data:t}),t.__icon_url__&&e.includes(t.__icon_url__)&&r.push({path:a,type:"icon",data:t}),Object.entries(t))){let t=a?"".concat(a,".").concat(s):s;if(Array.isArray(n))for(let a=0;a<n.length;a++){let s=x(e,n[a],"".concat(t,"[").concat(a,"]"));r.push(...s)}else if(n&&"object"==typeof n){let a=x(e,n,t);r.push(...a)}}return r},v=(e,t,a)=>{var r;let s=x(e,a);if(0===s.length)return null;if(1===s.length)return s[0];let n=e=>{if(e instanceof HTMLImageElement)return e.src||null;if(e instanceof SVGElement){let t=e.closest("[data-path]");return(null==t?void 0:t.getAttribute("data-path"))||null}return null},l=(null===(r=m.current)||void 0===r?void 0:r.querySelectorAll("img, svg"))||[],i=Array.from(l).indexOf(t),o=[];l.forEach(t=>{let a=n(t);a&&b(a,e)&&o.push(t)});let c=o.indexOf(t);return c>=0&&c<s.length?s[c]:i>=0&&i<s.length?s[i]:s[0]},b=(e,t)=>{if(!e||!t)return!1;if(e===t||(e&&e.replace(/^https?:\/\/[^\/]+/,"").replace(/^\/+/,""))===(t&&t.replace(/^https?:\/\/[^\/]+/,"").replace(/^\/+/,"")))return!0;if(e.includes("placeholder")&&t.includes("placeholder")||e.includes("/static/images/")&&t.includes("/static/images/"))return e===t;if(e.includes("/app_data/")||t.includes("/app_data/")){let a=e=>e.split("/").pop()||"",r=a(e);if(r===a(t)&&""!==r&&r.length>10)return!0}let a=e=>e.split("/").pop()||"",r=a(e);return r===a(t)&&""!==r&&r.length>10},y=()=>{if(!m.current)return;let e=m.current.querySelectorAll("img:not([data-editable-processed])"),t=m.current.querySelectorAll("svg:not([data-editable-processed])"),a=[];e.forEach((e,t)=>{let r=e.src;if(r){let l=v(r,e,c);if(l){var s,n;let{path:i,type:c,data:u}=l;e.setAttribute("data-editable-processed","true"),e.setAttribute("data-editable-id","".concat(o,"-").concat(c,"-").concat(i,"-").concat(t));let m={id:"".concat(o,"-").concat(c,"-").concat(i,"-").concat(t),type:c,src:r,dataPath:i,data:u,element:e};a.push(m);let p=e=>{e.preventDefault(),e.stopPropagation(),f(m)};e.addEventListener("click",p);let h=parseInt("".concat(o,"-").concat(c,"-").concat(i,"-").concat(t).split("-").pop()||"0"),g=null==d?void 0:d[h];e.style.cursor="pointer",e.style.transition="opacity 0.2s, transform 0.2s",e.style.objectFit=null==g?void 0:g.initialObjectFit,e.style.objectPosition="".concat(null==g?void 0:null===(s=g.initialFocusPoint)||void 0===s?void 0:s.x,"% ").concat(null==g?void 0:null===(n=g.initialFocusPoint)||void 0===n?void 0:n.y,"%");let x=()=>{e.style.opacity="0.8"},v=()=>{e.style.opacity="1"};e.addEventListener("mouseenter",x),e.addEventListener("mouseleave",v),e._editableCleanup=()=>{e.removeEventListener("click",p),e.removeEventListener("mouseenter",x),e.removeEventListener("mouseleave",v),e.style.cursor="",e.style.transition="",e.style.opacity="",e.style.transform="",e.removeAttribute("data-editable-processed")}}}}),t.forEach((e,t)=>{let r=e.closest("[data-path]"),s=(null==r?void 0:r.getAttribute("data-path"))||"";if(s){let r=v(s,e,c);if(r&&"icon"===r.type){let{path:n,data:l}=r;e.setAttribute("data-editable-processed","true"),e.setAttribute("data-editable-id","".concat(o,"-icon-").concat(n,"-svg-").concat(t));let i={id:"".concat(o,"-icon-").concat(n,"-svg-").concat(t),type:"icon",src:s,dataPath:n,data:l,element:e};a.push(i);let c=e=>{e.preventDefault(),e.stopPropagation(),f(i)};e.addEventListener("click",c),e.style.cursor="pointer",e.style.transition="opacity 0.2s, transform 0.2s";let d=()=>{e.style.opacity="0.8"},u=()=>{e.style.opacity="1"};e.addEventListener("mouseenter",d),e.addEventListener("mouseleave",u),e._editableCleanup=()=>{e.removeEventListener("click",c),e.removeEventListener("mouseenter",d),e.removeEventListener("mouseleave",u),e.style.cursor="",e.style.transition="",e.style.opacity="",e.style.transform="",e.removeAttribute("data-editable-processed")}}}}),h(e=>[...e,...a])},j=()=>{p.forEach(e=>{let{element:t}=e;t._editableCleanup&&t._editableCleanup()}),h([])};(0,s.useEffect)(()=>{let e=setTimeout(()=>{y()},400);return()=>{clearTimeout(e),j()}},[c,l]),(0,s.useEffect)(()=>{if(!m.current)return;let e=new MutationObserver(e=>{e.some(e=>Array.from(e.addedNodes).some(e=>e.nodeType===Node.ELEMENT_NODE&&("IMG"===e.tagName||"SVG"===e.tagName||e.querySelector("img:not([data-editable-processed]), svg:not([data-editable-processed])"))))&&setTimeout(y,100)});return e.observe(m.current,{childList:!0,subtree:!0}),()=>e.disconnect()},[c]);let N=()=>{f(null)};return(0,r.jsxs)("div",{ref:m,className:"editable-layout-wrapper w-full ",children:[l,g&&"image"===g.type&&(0,r.jsx)(E,{initialImage:g.src,slideIndex:o,promptContent:(null===(t=g.data)||void 0===t?void 0:t.__image_prompt__)||"",imageIdx:0,properties:null,onClose:N,onImageChange:(e,t)=>{if(g&&g.element){var a;g.element.src=e,u((0,i.hE)({slideIndex:o,dataPath:g.dataPath,imageUrl:e,prompt:t||(null===(a=g.data)||void 0===a?void 0:a.__image_prompt__)||""})),f(null)}},onFocusPointClick:e=>{let t=null==g?void 0:g.id,a=document.querySelector('[data-editable-id="'.concat(t,'"]'));a&&(a.style.objectFit=e.initialObjectFit,a.style.objectPosition="".concat(e.initialFocusPoint.x,"% ").concat(e.initialFocusPoint.y,"%")),u((0,i.Gq)({slideIndex:o,itemIndex:parseInt((null==g?void 0:g.id.split("-").pop())||"0"),properties:e}))}}),g&&"icon"===g.type&&(0,r.jsx)(k,{icon_prompt:(null===(a=g.data)||void 0===a?void 0:a.__icon_query__)?[g.data.__icon_query__]:[],onClose:N,onIconChange:(e,t)=>{if(console.log("newIconUrl",e),g&&g.element){var a;u((0,i.c1)({slideIndex:o,dataPath:g.dataPath,iconUrl:e,query:t||(null===(a=g.data)||void 0===a?void 0:a.__icon_query__)||""}))}}})]})};class A extends s.Component{static getDerivedStateFromError(e){return{hasError:!0,errorMessage:e instanceof Error?e.message:String(e)}}componentDidCatch(e){console.error("Slide render error:",e)}render(){return this.state.hasError?(0,r.jsxs)("div",{className:"aspect-video w-full h-full bg-red-50 text-red-700 flex flex-col items-start justify-start p-4 space-y-2 rounded-md border border-red-200",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:this.props.label?"".concat(this.props.label," render error"):"Slide render error"}),(0,r.jsx)("pre",{className:"text-xs whitespace-pre-wrap break-words max-h-full overflow-auto bg-red-100 rounded-md p-2 border border-red-200",children:this.state.errorMessage})]}):this.props.children}constructor(e){super(e),this.state={hasError:!1,errorMessage:""}}}var I=a(34040),T=a(63200),F=a(54603),O=a(35349),L=a(78234),U=a(81328),R=a(19680),z=a(17494),D=a(18778),M=a(64935),G=e=>{let{content:t,onContentChange:a,className:n="",placeholder:l="Enter text..."}=e,i=(0,T.jE)({extensions:[F.Z,O.U,L.Z],content:t||l,editorProps:{attributes:{class:"outline-none focus:outline-none transition-all duration-200 ".concat(n),"data-placeholder":l}},onBlur:e=>{let{editor:t}=e,r=null==t?void 0:t.storage.markdown.getMarkdown();a&&a(r)},editable:!0,immediatelyRender:!1});return((0,s.useEffect)(()=>{i&&(t||"")!==(null==i?void 0:i.storage.markdown.getMarkdown())&&i.commands.setContent(t||"")},[t,i]),i)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(T.NM,{editor:i,className:"z-50",tippyOptions:{duration:100},children:(0,r.jsxs)("div",{style:{zIndex:100},className:"flex text-black bg-white  rounded-lg shadow-lg p-2 gap-1 border border-gray-200 z-50",children:[(0,r.jsx)("button",{onClick:()=>null==i?void 0:i.chain().focus().toggleBold().run(),className:"p-1 rounded hover:bg-gray-100 transition-colors ".concat((null==i?void 0:i.isActive("bold"))?"bg-blue-100 text-blue-600":""),title:"Bold",children:(0,r.jsx)(U.Z,{className:"h-4 w-4"})}),(0,r.jsx)("button",{onClick:()=>null==i?void 0:i.chain().focus().toggleItalic().run(),className:"p-1 rounded hover:bg-gray-100 transition-colors ".concat((null==i?void 0:i.isActive("italic"))?"bg-blue-100 text-blue-600":""),title:"Italic",children:(0,r.jsx)(R.Z,{className:"h-4 w-4"})}),(0,r.jsx)("button",{onClick:()=>null==i?void 0:i.chain().focus().toggleUnderline().run(),className:"p-1 rounded hover:bg-gray-100 transition-colors ".concat((null==i?void 0:i.isActive("underline"))?"bg-blue-100 text-blue-600":""),title:"Underline",children:(0,r.jsx)(z.Z,{className:"h-4 w-4"})}),(0,r.jsx)("button",{onClick:()=>null==i?void 0:i.chain().focus().toggleStrike().run(),className:"p-1 rounded hover:bg-gray-100 transition-colors ".concat((null==i?void 0:i.isActive("strike"))?"bg-blue-100 text-blue-600":""),title:"Strikethrough",children:(0,r.jsx)(D.Z,{className:"h-4 w-4"})}),(0,r.jsx)("button",{onClick:()=>null==i?void 0:i.chain().focus().toggleCode().run(),className:"p-1 rounded hover:bg-gray-100 transition-colors ".concat((null==i?void 0:i.isActive("code"))?"bg-blue-100 text-blue-600":""),title:"Code",children:(0,r.jsx)(M.Z,{className:"h-4 w-4"})})]})}),(0,r.jsx)(T.kg,{editor:i,className:"tiptap-text-editor w-full",style:{lineHeight:"inherit",fontSize:"inherit",fontWeight:"inherit",fontFamily:"inherit",color:"inherit",textAlign:"inherit"}})]}):(0,r.jsx)("div",{className:n,children:t||l})};F.Z,O.U,L.Z;var B=e=>{let{children:t,slideData:a,slideIndex:n,onContentChange:l=()=>{}}=e,i=(0,s.useRef)(null),[o,c]=(0,s.useState)(new Set),d=(0,s.useRef)(new Map);(0,s.useEffect)(()=>{if(!i.current)return;let e=i.current,t=setTimeout(()=>{e.querySelectorAll("*").forEach(e=>{var t;if(o.has(e)||e.classList.contains("tiptap-text-editor")||e.closest(".tiptap-text-editor")||u(e))return;let s=p(e).trim();if(!s||s.length<=2||h(e)||g(e))return;let i=Array.from(e.classList),x=e.getAttribute("style"),v=f(a,s),b=document.createElement("div");b.style.cssText=x||"",b.className=Array.from(i).join(" "),e.parentNode&&(e.parentNode.replaceChild(b,e),e.innerHTML=""),c(t=>new Set(t).add(e));let y=I.createRoot(b),j=v.path&&null!==(t=m(a,v.path))&&void 0!==t?t:s;d.current.set(b,{root:y,dataPath:v.path,fallbackText:s}),y.render((0,r.jsx)(G,{content:j,onContentChange:e=>{v&&l&&l(e,v.path,n)},placeholder:"Enter text..."}))})},1e3);return()=>{clearTimeout(t)}},[a,n]),(0,s.useEffect)(()=>{d.current&&0!==d.current.size&&d.current.forEach(e=>{var t;let{root:s,dataPath:i,fallbackText:o}=e,c=i&&null!==(t=m(a,i))&&void 0!==t?t:o;s.render((0,r.jsx)(G,{content:c,onContentChange:e=>{i&&l&&l(e,i,n)},placeholder:"Enter text..."}))})},[a,n]);let u=e=>{let t=["TABLE","TBODY","THEAD","TFOOT","TR","TD","TH","SVG","G","PATH","CIRCLE","RECT","LINE","CANVAS","VIDEO","AUDIO","IFRAME","EMBED","OBJECT","SELECT","OPTION","OPTGROUP","SCRIPT","STYLE","NOSCRIPT"],a=["chart","graph","visualization","menu","dropdown","tooltip","editor","wysiwyg","calendar","datepicker","slider","carousel","flowchart","mermaid","diagram"],r=e;for(;r;){if(t.includes(r.tagName))return!0;let e=r.className.length>0?r.className.toLowerCase():"";if(a.some(t=>e.includes(t))||r.id.includes("mermaid")||r.hasAttribute("contenteditable")||r.hasAttribute("data-chart")||r.hasAttribute("data-visualization")||r.hasAttribute("data-interactive"))return!0;r=r.parentElement}return!1},m=(e,t)=>{if(!e||!t)return;let a=t.replace(/\[(\d+)\]/g,".$1").split(".").filter(Boolean),r=e;for(let e of a){if(null==r)return;r=r[e]}return r},p=e=>{let t="";for(let a of Array.from(e.childNodes))a.nodeType===Node.TEXT_NODE&&(t+=a.textContent||"");return t},h=e=>Array.from(e.children).some(e=>p(e).trim().length>1),g=e=>{if(["INPUT","TEXTAREA","SELECT","BUTTON"].includes(e.tagName)||e.hasAttribute("role")||e.hasAttribute("aria-label")||e.hasAttribute("data-testid")||e.querySelector("img, svg, button, input, textarea, select, a[href]")||["grid","flex","space-","gap-","container","wrapper"].some(t=>e.className.length>0&&e.className.includes(t)))return!0;let t=p(e).trim();return t.length<2||t.length<3},f=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!e||"object"!=typeof e)return{path:"",originalText:""};for(let[r,s]of Object.entries(e)){let e=a?"".concat(a,".").concat(r):r;if("string"==typeof s&&s.trim()===t.trim())return{path:e,originalText:s};if(Array.isArray(s))for(let a=0;a<s.length;a++){let r=f(s[a],t,"".concat(e,"[").concat(a,"]"));if(r.path)return r}else if("object"==typeof s&&null!==s){let a=f(s,t,e);if(a.path)return a}}return{path:"",originalText:""}};return(0,r.jsx)("div",{ref:i,className:"tiptap-text-replacer",children:t})};let V=()=>{let e=(0,n.I0)(),{getLayoutById:t,getLayout:a,loading:o}=(0,l.$)(),c=(0,s.useMemo)(()=>(e,r)=>t(e)?a(e):null,[t,a]),d=(0,s.useMemo)(()=>(t,a)=>{let s=c(t.layout,t.layout_group);return o?(0,r.jsx)("div",{className:"flex flex-col items-center justify-center aspect-video h-full bg-gray-100 rounded-lg",children:(0,r.jsx)(h.Z,{className:"w-8 h-8 animate-spin text-blue-800"})}):s?a?(0,r.jsx)(S,{slideIndex:t.index,slideData:t.content,properties:t.properties,children:(0,r.jsx)(B,{slideData:t.content,slideIndex:t.index,onContentChange:(t,a,r)=>{a&&void 0!==r&&e((0,i.hT)({slideIndex:r,dataPath:a,content:t}))},children:(0,r.jsx)(A,{label:"Slide ".concat(t.index+1),children:(0,r.jsx)(s,{data:t.content})})},t.id)}):(0,r.jsx)(A,{label:"Slide ".concat(t.index+1),children:(0,r.jsx)(s,{data:t.content})}):(0,r.jsx)("div",{className:"flex flex-col items-center justify-center aspect-video h-full bg-gray-100 rounded-lg",children:(0,r.jsxs)("p",{className:"text-gray-600 text-center text-base",children:['Layout "',t.layout,'" not found in "',t.layout_group,'" group']})})},[c,e]);return{getTemplateLayout:c,renderSlideContent:d,loading:o}}},5045:function(e,t,a){a.d(t,{_:function(){return n}});var r=a(84025),s=a(79875);class n{static async getPresentations(){try{let e=await fetch("/api/v1/ppt/presentation/all",{method:"GET"});if(404===e.status)return console.log("No presentations found"),[];return await s.z.handleResponse(e,"Failed to fetch presentations")}catch(e){throw console.error("Error fetching presentations:",e),e}}static async getPresentation(e){try{let t=await fetch("/api/v1/ppt/presentation/".concat(e),{method:"GET"});return await s.z.handleResponse(t,"Presentation not found")}catch(e){throw console.error("Error fetching presentation:",e),e}}static async deletePresentation(e){try{let t=await fetch("/api/v1/ppt/presentation/".concat(e),{method:"DELETE",headers:(0,r.P)()});return await s.z.handleResponseWithResult(t,"Failed to delete presentation")}catch(e){return console.error("Error deleting presentation:",e),{success:!1,message:e instanceof Error?e.message:"Failed to delete presentation"}}}}},95186:function(e,t,a){a.d(t,{I:function(){return l}});var r=a(57437),s=a(2265),n=a(94508);let l=s.forwardRef((e,t)=>{let{className:a,type:s,...l}=e;return(0,r.jsx)("input",{type:s,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...l})});l.displayName="Input"},69304:function(e,t,a){a.d(t,{FF:function(){return g},Tu:function(){return h},bC:function(){return f},ue:function(){return p},yo:function(){return c}});var r=a(57437),s=a(2265),n=a(49027),l=a(20653),i=a(90535),o=a(94508);let c=n.fC;n.xz,n.x8;let d=n.h_,u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t})});u.displayName=n.aV.displayName;let m=(0,i.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),p=s.forwardRef((e,t)=>{let{side:a="right",className:s,children:i,...c}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(n.VY,{ref:t,className:(0,o.cn)(m({side:a}),s),...c,children:[(0,r.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,r.jsx)(l.Pxu,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]}),i]})]})});p.displayName=n.VY.displayName;let h=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};h.displayName="SheetHeader";let g=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};g.displayName="SheetFooter";let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold text-foreground",a),...s})});f.displayName=n.Dx.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...s})}).displayName=n.dk.displayName},93022:function(e,t,a){a.d(t,{O:function(){return n}});var r=a(57437),s=a(94508);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-primary/10",t),...a})}},12339:function(e,t,a){a.d(t,{SP:function(){return c},dr:function(){return o},mQ:function(){return i},nU:function(){return d}});var r=a(57437),s=a(2265),n=a(41312),l=a(94508);let i=n.fC,o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.aV,{ref:t,className:(0,l.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",a),...s})});o.displayName=n.aV.displayName;let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.xz,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",a),...s})});c.displayName=n.xz.displayName;let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.VY,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s})});d.displayName=n.VY.displayName},76818:function(e,t,a){a.d(t,{g:function(){return l}});var r=a(57437),s=a(2265),n=a(94508);let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("textarea",{className:(0,n.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...s})});l.displayName="Textarea"},46281:function(e,t,a){a.d(t,{AuthProvider:function(){return u},a:function(){return m}});var r=a(57437),s=a(2265),n=a(71545),l=a(25566);let i=l.env.NEXT_PUBLIC_SUPABASE_URL||"https://placeholder.supabase.co",o=l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"placeholder-anon-key",c=(0,n.eI)(i,o),d=(0,s.createContext)(void 0);function u(e){let{children:t}=e,[a,n]=(0,s.useState)(null),[l,i]=(0,s.useState)({presentations_generated:0,presentations_exported:0,api_calls_made:0,images_generated:0,documents_processed:0}),[o,u]=(0,s.useState)({max_presentations_per_month:3,max_exports_per_month:3,max_api_calls_per_month:50,max_images_per_month:5,max_documents_per_month:2,can_use_custom_templates:!1,can_use_premium_templates:!1,can_export_pdf:!0,can_export_pptx:!0,max_file_upload_size_mb:10}),[m,p]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await c.auth.getSession();e&&await h(e.access_token)}catch(e){console.error("Auth initialization error:",e)}finally{p(!1)}})();let{data:{subscription:e}}=c.auth.onAuthStateChange(async(e,t)=>{t?await h(t.access_token):(n(null),i({presentations_generated:0,presentations_exported:0,api_calls_made:0,images_generated:0,documents_processed:0}))});return()=>{e.unsubscribe()}},[]);let h=async e=>{try{localStorage.setItem("auth_token",e);let t=await fetch("/api/v1/user/me",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();n(e.user),i(e.usage),u(e.limits)}}catch(e){console.error("Failed to fetch user data:",e)}},g=async(e,t)=>{let{data:a,error:r}=await c.auth.signInWithPassword({email:e,password:t});if(r)throw r;a.session&&await h(a.session.access_token)},f=async(e,t,a)=>{let{data:r,error:s}=await c.auth.signUp({email:e,password:t,options:{data:{full_name:a}}});if(s)throw s;r.session&&await h(r.session.access_token)},x=async()=>{let{error:e}=await c.auth.signOut();if(e)throw e;localStorage.removeItem("auth_token"),sessionStorage.removeItem("auth_token"),n(null),i({presentations_generated:0,presentations_exported:0,api_calls_made:0,images_generated:0,documents_processed:0})},v=async()=>{let{data:{session:e}}=await c.auth.getSession();e&&await h(e.access_token)},b=async()=>{var e;let{data:t}=await c.auth.getSession();return(null===(e=t.session)||void 0===e?void 0:e.access_token)||null},y=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=await b();if(!a)return!1;try{let r=await fetch("/api/v1/user/usage/check/".concat(e,"?amount=").concat(t),{headers:{Authorization:"Bearer ".concat(a)}});if(r.ok)return(await r.json()).allowed;return!1}catch(e){return console.error("Failed to check usage limit:",e),!1}};return(0,r.jsx)(d.Provider,{value:{user:a,usage:l,limits:o,loading:m,signIn:g,signUp:f,signOut:x,refreshUser:v,getAuthToken:b,checkUsageLimit:y},children:t})}function m(){let e=(0,s.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);